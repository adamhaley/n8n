<VirtualHost 165.232.135.82:443 >
        SSLEngine on
        SSLCertificateFile /usr/local/directadmin/data/users/ahmedia/domains/ahmedia.ai.cert.combined
        SSLCertificateKeyFile /usr/local/directadmin/data/users/ahmedia/domains/ahmedia.ai.key
        ServerName www.n8n.ahmedia.ai
        ServerAlias www.n8n.ahmedia.ai n8n.ahmedia.ai
        ServerAdmin info@ahmedia.ai
        DocumentRoot "/home/ahmedia/domains/n8n.ahmedia.ai/public_html"
        UseCanonicalName OFF
        SuexecUserGroup ahmedia ahmedia
        CustomLog /var/log/httpd/domains/ahmedia.ai.n8n.bytes bytes
        CustomLog /var/log/httpd/domains/ahmedia.ai.n8n.log combined
        ErrorLog /var/log/httpd/domains/ahmedia.ai.n8n.error.log

        RemoteIPHeader CF-Connecting-IP

        # Rewrite rules to handle WebSocket connections
        RewriteEngine On
        RewriteCond %{HTTP:Upgrade} =websocket [NC]
        RewriteRule /(.*) ws://127.0.0.1:5678/$1 [P,L]

        # Rewrite rule for other HTTP requests
        RewriteCond %{HTTP:Upgrade} !=websocket [NC]
        RewriteRule /(.*) http://127.0.0.1:5678/$1 [P,L]

        ProxyPass / http://127.0.0.1:5678/
        ProxyPassReverse / http://n8n.ahmedia.ai

        <Directory "/home/ahmedia/domains/n8n.ahmedia.ai/public_html">
                AllowOverride AuthConfig FileInfo Indexes Limit Options=Indexes,IncludesNOEXEC,MultiViews,SymLinksIfOwnerMatch,FollowSymLinks,None
                Options -ExecCGI -Includes +IncludesNOEXEC
                <FilesMatch "\.(inc|php|phtml|phps)$">
                        <If "-f %{REQUEST_FILENAME}">
                                #ProxyErrorOverride on
                                <IfVersion = /^2.4.6[012]$/>
                                        ProxyFCGISetEnvIf "true" SCRIPT_FILENAME "%{unescape:%{SCRIPT_FILENAME}}"
                                </IfVersion>
                                AddHandler "proxy:unix:/usr/local/php82/sockets/ahmedia.sock|fcgi://localhost" .inc .php .phtml
                        </If>
                </FilesMatch>
                <FilesMatch "\.(php53|php54|php55|php56|php70|php71|php72|php73|php74|php80|php81|php82)$">
                        Order Allow,Deny
                        Deny from all
                </FilesMatch>
        </Directory>
</VirtualHost>
